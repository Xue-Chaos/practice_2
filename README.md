**任务二描述：**

**基于ZigBee模块（白板）做基础开发，采用中断的方式开发按键功能，并根据串口发送来指令进行温湿度传感数据的采集，能根据温湿度情况控制LED灯的亮灭，可实现温湿度数据通过串口发送。（注意：**温湿度传感器插在ZigBee模块的传感器插座上，把ZigBee模块放在智慧盒上**）**

**设备列表：**

1、PC机1台

2、ZigBee模块(白板) 1块

3、温湿度光敏传感器1个（或温湿度传感器）

4、智慧盒1套

5、CC Debugger仿真器1套

**任务要求：**

打开工程源码目录“..\\work\\Task\\”文件夹下的IAR工程chuji_wkspc.eww，把“Task” 文件夹下的“test.c”文件**添加到IAR工程中**，配置好工程选项参数，确保工程编译成功。（4分）。在“test.c”中添加代码实现以下功能：（注意：题目中涉及的变量均已在test.c中定义）

1、ZigBee模块一上电，所有LED灯不亮。(8分)

2、每次按下SW1按键，LED2灯亮灭状态反转。（3分）

3、按键SW1采用中断方式进行控制，上拉输入模式，下降沿触发中断。（6分）

4、当从串口接收到数据“0xAF”时，LED1灯点亮，表示进入自动工作模式；当从串口接收到数据“0xBF”时，LED1灯熄灭，表示退出自动工作模式。（串口模块已完成初始化设置，波特率115200，8位数据位，1位停止位，无校验位，无流控）（12分）

5、定时器1已配置好，每50ms产生一次溢出中断，考生无须处理。

6、自动工作模式下，每2秒调用已提供的void SHT_SmpSnValue(int8 \*tem, uint8 \*hum) 函数采集一次温湿度数据，此时采集出来的温湿度都是经过计算后的16进制的值，通过已提供的UART0SendData(参数)函数将温湿度传感数据通过串口发送出去，传输数据为2个字节，第1个字节是温度，第2个字节是湿度。

7、自动工作模式下，使用串口助手观察输出的温度、湿度数据，用手捂住温湿度传感器，可以看到采集到的温湿度数据发生了变化，把串口助手的输出信息进行截图并保存至“图集.docx”中的9.png处。按照观察到的值进行适当的阀值设定，实现当湿度超过自定义阀值时（比如0x25）LED2灯点亮，当湿度低于自定义阀值时时LED2灯熄灭，SW1按键不再起控制LED2灯的作用。

8、程序编写完毕，编译并下载到ZigBee白板后按一下烧写器的复位按钮，按上述要求进行功能测试。

9、**考试时间截止后，应确保“图集.docx”和源码工程文件已保存妥当，将“work”文件夹压缩成“work.zip”文件，点击“上传文件”将压缩后的“work.zip”上传至服务器指定目录。**
